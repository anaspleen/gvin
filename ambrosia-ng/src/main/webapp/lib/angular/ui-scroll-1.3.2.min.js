/*!
 * angular-ui-scroll
 * https://github.com/angular-ui/ui-scroll.git
 * Version: 1.3.2 -- 2015-10-27T14:48:21.672Z
 * License: MIT
 */
!function(){"use strict";angular.module("ui.scroll",[]).directive("uiScrollViewport",function(){return{controller:["$scope","$element",function(a,b){return this.viewport=b,this}]}}).directive("uiScroll",["$log","$injector","$rootScope","$timeout","$q","$parse",function(a,b,c,d,e,f){var g;return b.has&&b.has("$animate")&&(g=b.get("$animate")),{require:["?^uiScrollViewport"],transclude:"element",priority:1e3,terminal:!0,compile:function(h,i,j){return function(h,i,k,l,m){var n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ba,ca,da,ea,fa,ga,ha,ia;if(m=m||j,T=a.debug||a.log,!(U=k.uiScroll.match(/^\s*(\w+)\s+in\s+([\w\.]+)\s*$/)))throw new Error("Expected uiScroll in form of '_item_ in _datasource_' but got '"+k.uiScroll+"'");if(R=U[1],D=U[2],C=f(D)(h),P=function(){return angular.isObject(C)&&angular.isFunction(C.get)},!P()&&(C=b.get(D),!P()))throw new Error(D+" is not a valid datasource");return x=Math.max(3,+k.bufferSize||10),w=function(){return fa.outerHeight()*Math.max(.1,+k.padding||.1)},_=function(a){var b;return null!=(b=a[0].scrollHeight)?b:a[0].document.documentElement.scrollHeight},O=1===angular.version.major&&angular.version.minor<3,K=function(a,b){return i.after.apply(b,[a]),[]},L=g?O?function(a,b){var c;return c=e.defer(),g.enter(a,i,b,function(){return c.resolve()}),[c.promise]}:function(a,b){return[g.enter(a,i,b)]}:K,n=function(){var a,b;return a=Object.create(Array.prototype),b=g?O?function(b){var c;return a.splice(a.indexOf(b),1),c=e.defer(),g.leave(b.element,function(){return b.scope.$destroy(),c.resolve()}),[c.promise]}:function(b){return a.splice(a.indexOf(b),1),[g.leave(b.element).then(function(){return b.scope.$destroy()})]}:function(b){return a.splice(a.indexOf(b),1),b.element.remove(),b.scope.$destroy(),[]},a.remove=function(c,d){var e,f,g,h;if(angular.isNumber(c)){for(e=f=g=c,h=d;h>=g?h>f:f>h;e=h>=g?++f:--f)a[e].scope.$destroy(),a[e].element.remove();return a.splice(c,d-c)}return b(c)},a.clear=function(){return a.remove(0,a.length)},a},y=null,$=0,J=1,V=1,v=new n,W=[],G=!1,t=!1,m(h.$new(),function(a,b){var c,d,e,f,g;if(b.$destroy(),e=a[0].localName,"dl"===e)throw new Error("ui-scroll directive does not support <"+a[0].localName+"> as a repeating tag: "+a[0].outerHTML);return"li"!==e&&"tr"!==e&&(e="div"),g=l[0]&&l[0].viewport?l[0].viewport:angular.element(window),g.css({"overflow-y":"auto",display:"block"}),d=function(a){var b,c,d;switch(a){case"tr":d=angular.element("<table><tr><td><div></div></td></tr></table>"),b=d.find("div"),c=d.find("tr"),c.paddingHeight=function(){return b.height.apply(b,arguments)};break;default:c=angular.element("<"+a+"></"+a+">"),c.paddingHeight=c.height}return c},f=d(e),i.before(f),c=d(e),i.after(c),h.$on("$destroy",function(){return a.remove()}),y={viewport:g,topPadding:function(){return f.paddingHeight.apply(f,arguments)},bottomPadding:function(){return c.paddingHeight.apply(c,arguments)},bottomDataPos:function(){return _(g)-c.paddingHeight()},topDataPos:function(){return f.paddingHeight()},insertElement:function(a,b){return K(a,b||f)},insertElementAnimated:function(a,b){return L(a,b||f)}}}),fa=y.viewport,ga=fa.scope()||c,ca=function(a){return o.topVisible=a.scope[R],o.topVisibleElement=a.element,o.topVisibleScope=a.scope,k.topVisible&&f(k.topVisible).assign(ga,o.topVisible),k.topVisibleElement&&f(k.topVisibleElement).assign(ga,o.topVisibleElement),k.topVisibleScope&&f(k.topVisibleScope).assign(ga,o.topVisibleScope),angular.isFunction(C.topVisible)?C.topVisible(a):void 0},S=function(a){return o.isLoading=a,k.isLoading&&f(k.isLoading).assign(h,a),angular.isFunction(C.loading)?C.loading(a):void 0},E=function(){return $++,W=[]},Y=function(){return E(),J=1,V=1,v.clear(),y.topPadding(0),y.bottomPadding(0),G=!1,t=!1,q($)},u=function(){return fa.scrollTop()+fa.outerHeight()},da=function(){return fa.scrollTop()},aa=function(){return!G&&y.bottomDataPos()<u()+w()},A=function(){var a,b,c,d,e,f,g,h,i,j;for(a=0,h=0,b=f=i=v.length-1;0>=i?0>=f:f>=0;b=0>=i?++f:--f)if(c=v[b],e=c.element.offset().top,g=j!==e,j=e,g&&(d=c.element.outerHeight(!0)),y.bottomDataPos()-a-d>u()+w())g&&(a+=d),h++,G=!1;else{if(g)break;h++}return h>0?(y.bottomPadding(y.bottomPadding()+a),v.remove(v.length-h,v.length),V-=h):void 0},ba=function(){return!t&&y.topDataPos()>da()-w()},B=function(){var a,b,c,d,e,f,g,h,i;for(i=0,g=0,d=0,e=v.length;e>d;d++)if(a=v[d],c=a.element.offset().top,f=h!==c,h=c,f&&(b=a.element.outerHeight(!0)),y.topDataPos()+i+b<da()-w())f&&(i+=b),g++,t=!1;else{if(f)break;g++}return g>0?(y.topPadding(y.topPadding()+i),v.remove(0,g),J+=g):void 0},F=function(a,b){return o.isLoading||S(!0),1===W.push(b)?I(a):void 0},M=function(a,b){var c,d;if(c=h.$new(),c[R]=b,d={scope:c},m(c,function(a){return d.element=a}),a%1===0)return d.op="insert",v.splice(a,0,d);switch(d.op=a,a){case"append":return v.push(d);case"prepend":return v.unshift(d)}},Q=function(a){return a.element.height()&&a.element[0].offsetParent},ha=function(a){var b,c,d;if(Q(a)){for(c=0,d=v.length;d>c;c++)b=v[c],angular.isFunction(b.unregisterVisibilityWatcher)&&(b.unregisterVisibilityWatcher(),delete b.unregisterVisibilityWatcher);return q()}},N=function(a,b){return y.insertElement(a.element,b),Q(a)?!0:(a.unregisterVisibilityWatcher=a.scope.$watch(function(){return ha(a)}),!1)},X=function(a){var b,c,d,f,g,h,i,j,k,l,m,n,o,p,r,s,t;for(p=[],r=[],s=[],b=y.bottomDataPos(),d=g=0,k=v.length;k>g;d=++g)switch(t=v[d],t.op){case"prepend":r.unshift(t);break;case"append":i=0===d?N(t)||i:N(t,v[d-1].element)||i,t.op="none";break;case"insert":p=0===d?p.concat(y.insertElementAnimated(t.element)):p.concat(y.insertElementAnimated(t.element,v[d-1].element)),t.op="none";break;case"remove":s.push(t)}for(h=0,l=s.length;l>h;h++)t=s[h],p=p.concat(v.remove(t));if(y.bottomPadding(Math.max(0,y.bottomPadding()-(y.bottomDataPos()-b))),r.length){for(b=y.bottomDataPos(),j=0,m=r.length;m>j;j++)t=r[j],i=N(t)||i,t.op="none";c=y.bottomDataPos()-b,y.topPadding()>=c?y.topPadding(y.topPadding()-c):fa.scrollTop(fa.scrollTop()+c)}for(d=o=0,n=v.length;n>o;d=++o)f=v[d],f.scope.$index=J+d;return p.length&&e.all(p).then(function(){return q(a)}),i},z=function(){var a,b,c,d,e,f,g,h,i;for(i=0,g=[],d=0,e=v.length;e>d;d++){if(a=v[d],c=a.element.offset().top,f=h!==c,h=c,f&&(b=a.element.outerHeight(!0)),!(f&&y.topDataPos()+i+b<da())){f&&ca(a);break}g.push(i+=b)}return g},q=function(a){return d(function(){return X(a),aa()?F(a,!0):ba()&&F(a,!1),0===W.length?z():void 0})},r=function(a){return d(function(){var b;return b=X(a),aa()?b&&F(a,!0):ba()&&(b||W[0])&&F(a,!1),W.shift(),0===W.length?(S(!1),z()):I(a)})},I=function(a){return W[0]?v.length&&!aa()?r(a):C.get(V,x,function(b){var c,d,e;if(!(a&&a!==$||h.$$destroyed)){if(b.length<x&&(G=!0,y.bottomPadding(0)),b.length>0)for(B(),d=0,e=b.length;e>d;d++)c=b[d],++V,M("append",c);return r(a)}}):v.length&&!ba()?r(a):C.get(J-x,x,function(b){var c,d,e;if(!(a&&a!==$||h.$$destroyed)){if(b.length<x&&(t=!0,y.topPadding(0)),b.length>0)for(v.length&&A(),c=d=e=b.length-1;0>=e?0>=d:d>=0;c=0>=e?++d:--d)--J,M("prepend",b[c]);return r(a)}})},Z=function(){return c.$$phase||o.isLoading?void 0:(q(),h.$apply())},ia=function(a){var b,c;return b=fa[0].scrollTop,c=fa[0].scrollHeight-fa[0].clientHeight,0===b&&!t||b===c&&!G?a.preventDefault():void 0},fa.bind("resize",Z),fa.bind("scroll",Z),fa.bind("mousewheel",ia),h.$watch(C.revision,Y),h.$on("$destroy",function(){return v.clear(),fa.unbind("resize",Z),fa.unbind("scroll",Z),fa.unbind("mousewheel",ia)}),o={},o.isLoading=!1,o.reload=Y,s=function(a,b){var c,d,e,f,g,h,i;if(angular.isArray(b)){for(h=v.indexOf(a)+1,i=b.reverse(),c=d=0,f=i.length;f>d;c=++d)g=i[c],g===a.scope[R]?(e=!0,h--):M(h,g);if(!e)return a.op="remove"}},o.applyUpdates=function(a,b){var c,d,e,f,g,h;if(E(),angular.isFunction(a))for(c=v.slice(0),d=e=0,f=c.length;f>e;d=++e)h=c[d],s(h,a(h.scope[R],h.scope,h.element));else{if(a%1!==0)throw new Error("applyUpdates - "+a+" is not a valid index");0<=(g=a-J)&&g<v.length&&s(v[a-J],b)}return q($)},o.append=function(a){var b,c,d;for(E(),c=0,d=a.length;d>c;c++)b=a[c],++V,M("append",b);return q($)},o.prepend=function(a){var b,c,d,e;for(E(),e=a.reverse(),c=0,d=e.length;d>c;c++)b=e[c],--J,M("prepend",b);return q($)},k.adapter&&(p=f(k.adapter)(h),angular.isObject(p)||(f(k.adapter).assign(h,{}),p=f(k.adapter)(h)),angular.extend(p,o),o=p),ea=function(a){throw new Error(a+" event is no longer supported - use applyUpdates instead")},H=C.scope?C.scope.$new():h.$new(),H.$on("insert.item",function(){return ea("insert")}),H.$on("update.items",function(){return ea("update")}),H.$on("delete.items",function(){return ea("delete")})}}}}])}();